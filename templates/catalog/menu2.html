{% load static %}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- SEO -->
    <title>–ú–µ–Ω—é - {{ COMPANY_NAME }}</title>
    <meta name="description" content="–ú–µ–Ω—é –±–ª—é–¥ –∏ –Ω–∞–ø–∏—Ç–∫–æ–≤ {{ COMPANY_NAME }}. –°–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –≤–∫—É—Å–Ω—ã–µ –±–ª—é–¥–∞.">
    <meta name="keywords" content="–º–µ–Ω—é, —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∫–∞—Ñ–µ, –±–ª—é–¥–∞, –µ–¥–∞, –¥–æ—Å—Ç–∞–≤–∫–∞">

    <!-- Open Graph -->
    <meta property="og:title" content="–ú–µ–Ω—é - {{ COMPANY_NAME }}">
    <meta property="og:description" content="–ú–µ–Ω—é –±–ª—é–¥ –∏ –Ω–∞–ø–∏—Ç–∫–æ–≤ {{ COMPANY_NAME }}">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ru_RU">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/Abak_Market-removebg-preview.png' %}">
    <link rel="apple-touch-icon" href="{% static 'images/Abak_Market-removebg-preview.png' %}">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{% static 'css/menu.css' %}?v=2.6">
    <link rel="stylesheet" href="{% static 'css/cart.css' %}?v=1.1">
</head>

<body class="menu-page" data-whatsapp="{{ company_whatsapp|slice:'1:' }}">
    <!-- Header -->
    <header class="menu-header">
        <a href="{% url 'home' %}">
            <img src="{% static 'images/Abak_Market-removebg-preview.png' %}" alt="{{ COMPANY_NAME }}"
                class="site-logo">
        </a>

        <!-- Header Search -->
        <div class="header-search">
            <form action="{% url 'catalog:menu' %}" method="GET">
                <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." value="{{ search_query|default:'' }}"
                    autocomplete="off">
                {% if current_category %}
                <input type="hidden" name="category" value="{{ current_category }}">
                {% endif %}
            </form>
        </div>
    </header>

    <div class="menu-container">
        <!-- Search Results (only shown if searching) -->
        {% if search_query %}
        <!-- Search Results Header -->
        <div style="margin-bottom: 20px; padding: 15px; background: #f8f4ef; border-radius: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span style="font-size: 0.875rem; color: #888;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</span>
                    <strong style="margin-left: 8px;">¬´{{ search_query }}¬ª</strong>
                    <span style="margin-left: 8px; color: #888;">({{ search_total }} –Ω–∞–π–¥–µ–Ω–æ)</span>
                </div>
                <a href="{% url 'catalog:menu' %}" style="color: #c4a574; font-weight: 600; text-decoration: none;">
                    ‚úï –°–±—Ä–æ—Å–∏—Ç—å
                </a>
            </div>
            {% if search_suggestions %}
            <div style="margin-top: 12px; font-size: 0.875rem;">
                <span style="color: #888;">–ü–æ—Ö–æ–∂–∏–µ –∑–∞–ø—Ä–æ—Å—ã:</span>
                {% for suggestion in search_suggestions %}
                <a href="{% url 'catalog:menu' %}?q={{ suggestion.query }}"
                    style="margin-left: 8px; color: #c4a574; text-decoration: underline;">
                    {{ suggestion.query }}
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Category Navigation -->
        <nav class="menu-nav">
            <a href="{% url 'catalog:menu' %}"
                class="menu-nav-item {% if not current_category and not search_query %}active{% endif %}">
                –í—Å–µ
            </a>
            {% for category in categories %}
            <a href="{% url 'catalog:menu' %}?category={{ category.slug }}"
                class="menu-nav-item {% if current_category == category.slug %}active{% endif %}">
                {{ category.icon }} {{ category.name }}
            </a>
            {% endfor %}
        </nav>


        <!-- Products by Category -->
        {% if products_by_category %}
        {% for category, products in products_by_category.items %}
        <section class="menu-category" id="category-{{ category.slug }}">
            <!-- Category Header -->
            <div class="menu-category-header">
                <h2 class="menu-category-title">{{ category.name }}</h2>
                <div class="menu-category-divider">
                    <span class="ornament">‚óÜ</span>
                </div>
            </div>

            <div class="menu-grid">
                {% for product in products %}
                <div class="menu-card" id="product-{{ product.id }}">
                    <!-- Badge -->
                    {% if product.is_promotional %}
                    <span class="menu-card-badge">-{{ product.discount_percent }}%</span>
                    {% elif product.is_new %}
                    <span class="menu-card-badge new">–ù–æ–≤–∏–Ω–∫–∞</span>
                    {% elif product.is_featured %}
                    <span class="menu-card-badge popular">–•–∏—Ç</span>
                    {% endif %}

                    <!-- Image -->
                    <a href="{% url 'catalog:product' product.slug %}" class="menu-card-image">
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" loading="lazy">
                    </a>

                    <!-- Content -->
                    <div class="menu-card-content">
                        <div class="menu-card-info">
                            <h3 class="menu-card-name">{{ product.name }}</h3>
                            <div class="menu-card-price">
                                {% if product.old_price %}
                                <span class="menu-card-old-price">{{ product.formatted_old_price }}</span>
                                {% endif %}
                                {{ product.formatted_price }}
                            </div>
                            {% if product.weight %}
                            <span class="menu-card-weight">{{ product.weight }}</span>
                            {% endif %}
                        </div>

                        <button class="add-to-cart-btn" data-id="{{ product.id }}" data-name="{{ product.name }}"
                            data-price="{{ product.price }}" data-image="{{ product.image_url }}"
                            aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                                stroke-linecap="round" stroke-linejoin="round" style="width:20px;height:20px;">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
        {% else %}
        <!-- Empty State -->
        <div class="menu-empty">
            <div class="menu-empty-icon">üîç</div>
            {% if search_query %}
            <h3>–ü–æ –∑–∞–ø—Ä–æ—Å—É ¬´{{ search_query }}¬ª –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
            {% if search_suggestions %}
            <div style="margin-top: 16px;">
                <p style="font-size: 0.875rem; color: #888;">–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏—Å–∫–∞–ª–∏:</p>
                {% for suggestion in search_suggestions %}
                <a href="{% url 'catalog:menu' %}?q={{ suggestion.query }}"
                    style="display: inline-block; margin: 4px; padding: 8px 16px; background: #f8f4ef; border-radius: 20px; color: #333; text-decoration: none; font-size: 0.875rem;">
                    {{ suggestion.query }}
                </a>
                {% endfor %}
            </div>
            {% endif %}
            {% else %}
            <h3>–ë–ª—é–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
            {% endif %}
            <a href="{% url 'catalog:menu' %}" class="menu-order-btn"
                style="max-width: 200px; margin: var(--menu-spacing-lg) auto 0;">
                –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë
            </a>
        </div>
        {% endif %}

        <!-- Order Button -->
        <button class="menu-order-btn open-cart">
            <span style="font-size: 1.25rem; margin-right: 8px;">üõí</span>
            –û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É
        </button>
    </div>



    <!-- Bottom Navigation -->
    <nav class="menu-nav-bottom"
        style="display:flex;justify-content:space-around;background:var(--menu-card-bg);padding:var(--menu-spacing-md);position:fixed;bottom:0;left:0;right:0;box-shadow:0 -4px 20px var(--menu-shadow);z-index:1000;">
        <a href="{% url 'home' %}"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-text-medium);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üè†</span>
            –ì–ª–∞–≤–Ω–∞—è
        </a>
        <a href="{% url 'catalog:list' %}"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-text-medium);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üìã</span>
            –ö–∞—Ç–∞–ª–æ–≥
        </a>
        <a href="#" class="open-cart" onclick="if(window.toggleCart) toggleCart(true)"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-text-medium);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üõí</span>
            –ö–æ—Ä–∑–∏–Ω–∞
        </a>
        <a href="{% url 'contacts' %}"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-text-medium);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üìû</span>
            –ö–æ–Ω—Ç–∞–∫—Ç—ã
        </a>
    </nav>

    <!-- Scripts -->
    <script src="{% static 'js/cart.js?v=1.2' %}"></script>
    <!-- Smooth scroll script -->
    <script>
        // Add padding for bottom nav
        document.body.style.paddingBottom = '70px';

        // Smooth scroll to category
        document.querySelectorAll('.menu-nav-item').forEach(item => {
            item.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href.includes('#')) {
                    e.preventDefault();
                    const target = document.querySelector(href.split('#')[1] ? '#' + href.split('#')[1] : null);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });

        // Intersection Observer for active nav
        const categories = document.querySelectorAll('.menu-category');
        const navItems = document.querySelectorAll('.menu-nav-item');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    navItems.forEach(item => {
                        if (item.href.includes(id.replace('category-', ''))) {
                            item.classList.add('active');
                        } else if (!item.href.includes('category=')) {
                            // Keep "–í—Å–µ" active only if no category filter
                        }
                    });
                }
            });
        }, { threshold: 0.3 });

        categories.forEach(cat => observer.observe(cat));
    </script>

    <!-- Smart Search (autocomplete) -->
    <script src="{% static 'js/search.js' %}"></script>
</body>

</html>