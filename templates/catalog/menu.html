{% load static %}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- SEO -->
    <title>–ú–µ–Ω—é - {{ COMPANY_NAME }}</title>
    <meta name="description" content="–ú–µ–Ω—é –±–ª—é–¥ –∏ –Ω–∞–ø–∏—Ç–∫–æ–≤ {{ COMPANY_NAME }}. –°–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –≤–∫—É—Å–Ω—ã–µ –±–ª—é–¥–∞.">
    <meta name="keywords" content="–º–µ–Ω—é, —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –∫–∞—Ñ–µ, –±–ª—é–¥–∞, –µ–¥–∞, –¥–æ—Å—Ç–∞–≤–∫–∞">

    <!-- Open Graph -->
    <meta property="og:title" content="–ú–µ–Ω—é - {{ COMPANY_NAME }}">
    <meta property="og:description" content="–ú–µ–Ω—é –±–ª—é–¥ –∏ –Ω–∞–ø–∏—Ç–∫–æ–≤ {{ COMPANY_NAME }}">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ru_RU">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{% static 'css/menu.css' %}">
    <link rel="stylesheet" href="{% static 'css/cart.css' %}">
</head>

<body class="menu-page" data-whatsapp="{{ company_whatsapp|slice:'1:' }}">
    <!-- Header -->
    <header class="menu-header">
        <h1>{{ COMPANY_NAME }}</h1>
        <p class="subtitle">–ú–µ–Ω—é</p>
    </header>

    <div class="menu-container">
        <!-- Category Navigation -->
        <nav class="menu-nav">
            <a href="{% url 'catalog:menu' %}" class="menu-nav-item {% if not current_category %}active{% endif %}">
                –í—Å–µ
            </a>
            {% for category in categories %}
            <a href="{% url 'catalog:menu' %}?category={{ category.slug }}"
                class="menu-nav-item {% if current_category == category.slug %}active{% endif %}">
                {{ category.icon }} {{ category.name }}
            </a>
            {% endfor %}
        </nav>

        <!-- Filter Pills -->
        <div class="menu-filters">
            <a href="{% url 'catalog:menu' %}?filter=popular"
                class="menu-filter-pill {% if current_filter == 'popular' %}active{% endif %}">
                ‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ
            </a>
            <a href="{% url 'catalog:menu' %}?filter=new"
                class="menu-filter-pill {% if current_filter == 'new' %}active{% endif %}">
                üÜï –ù–æ–≤–∏–Ω–∫–∏
            </a>
            <a href="{% url 'catalog:menu' %}?filter=promo"
                class="menu-filter-pill {% if current_filter == 'promo' %}active{% endif %}">
                üî• –ê–∫—Ü–∏–∏
            </a>
        </div>

        <!-- Products by Category -->
        {% if products_by_category %}
        {% for category, products in products_by_category.items %}
        <section class="menu-category" id="category-{{ category.slug }}">
            <!-- Category Header -->
            <div class="menu-category-header">
                <h2 class="menu-category-title">{{ category.name }}</h2>
                <div class="menu-category-divider">
                    <span class="ornament">‚óÜ</span>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="menu-grid">
                {% for product in products %}
                <div class="menu-card" id="product-{{ product.id }}">
                    <!-- Badge -->
                    {% if product.is_promotional %}
                    <span class="menu-card-badge">-{{ product.discount_percent }}%</span>
                    {% elif product.is_new %}
                    <span class="menu-card-badge new">–ù–æ–≤–∏–Ω–∫–∞</span>
                    {% elif product.is_featured %}
                    <span class="menu-card-badge popular">–•–∏—Ç</span>
                    {% endif %}

                    <!-- Image -->
                    <a href="{% url 'catalog:product' product.slug %}" class="menu-card-image">
                        {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
                        {% else %}
                        <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
                        {% endif %}
                    </a>

                    <!-- Content -->
                    <div class="menu-card-content">
                        <!-- Title (Top) -->
                        <h3 class="menu-card-name">{{ product.name }}</h3>

                        <!-- Weight/Description code removed to keep it cleaner, weight is below with price -->

                        <!-- Price & Button (Bottom) -->
                        <div style="margin-top: auto;">

                            <div class="menu-card-price">
                                {% if product.old_price %}
                                <span class="menu-card-old-price">{{ product.formatted_old_price }}</span>
                                {% endif %}
                                {{ product.formatted_price }}

                                {% if product.weight %}
                                <span class="menu-card-weight"
                                    style="font-size: 0.8rem; font-weight: normal; margin-left: auto;">{{ product.weight
                                    }}</span>
                                {% endif %}
                            </div>

                            <button class="menu-card-add-btn add-to-cart-btn" data-id="{{ product.id }}"
                                data-name="{{ product.name }}" data-price="{{ product.price }}"
                                data-image="{% if product.image %}{{ product.image.url }}{% else %}{% static 'images/no-image.png' %}{% endif %}">
                                –í –∫–æ—Ä–∑–∏–Ω—É
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
        {% else %}
        <!-- Empty State -->
        <div class="menu-empty">
            <div class="menu-empty-icon">üçΩÔ∏è</div>
            <h3>–ë–ª—é–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
            <a href="{% url 'catalog:menu' %}" class="menu-order-btn"
                style="max-width: 200px; margin: var(--menu-spacing-lg) auto 0;">
                –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë
            </a>
        </div>
        {% endif %}

        <!-- Order Button -->
        <button class="menu-order-btn open-cart">
            <span style="font-size: 1.25rem; margin-right: 8px;">üõí</span>
            –û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É
        </button>
    </div>



    <!-- Bottom Navigation -->
    <nav class="menu-nav-bottom"
        style="display:flex;justify-content:space-around;background:var(--menu-card-bg);padding:var(--menu-spacing-md);position:fixed;bottom:0;left:0;right:0;box-shadow:0 -4px 20px var(--menu-shadow);z-index:1000;">
        <a href="{% url 'home' %}"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-text-medium);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üè†</span>
            –ì–ª–∞–≤–Ω–∞—è
        </a>
        <a href="{% url 'catalog:menu' %}"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-accent);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üçΩÔ∏è</span>
            –ú–µ–Ω—é
        </a>
        <a href="#" class="open-cart"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-text-medium);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üõí</span>
            –ö–æ—Ä–∑–∏–Ω–∞
        </a>
        <a href="{% url 'contacts' %}"
            style="display:flex;flex-direction:column;align-items:center;text-decoration:none;color:var(--menu-text-medium);font-size:0.6875rem;font-weight:600;gap:4px;">
            <span style="font-size:1.25rem;">üìû</span>
            –ö–æ–Ω—Ç–∞–∫—Ç—ã
        </a>
    </nav>

    <!-- Scripts -->
    <script src="{% static 'js/cart.js' %}"></script>
    <!-- Smooth scroll script -->
    <script>
        // Add padding for bottom nav
        document.body.style.paddingBottom = '70px';

        // Smooth scroll to category
        document.querySelectorAll('.menu-nav-item').forEach(item => {
            item.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href.includes('#')) {
                    e.preventDefault();
                    const target = document.querySelector(href.split('#')[1] ? '#' + href.split('#')[1] : null);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });

        // Intersection Observer for active nav
        const categories = document.querySelectorAll('.menu-category');
        const navItems = document.querySelectorAll('.menu-nav-item');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    navItems.forEach(item => {
                        if (item.href.includes(id.replace('category-', ''))) {
                            item.classList.add('active');
                        } else if (!item.href.includes('category=')) {
                            // Keep "–í—Å–µ" active only if no category filter
                        }
                    });
                }
            });
        }, { threshold: 0.3 });

        categories.forEach(cat => observer.observe(cat));
    </script>
</body>

</html>