{% extends 'base.html' %}
{% load static %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ - {{ COMPANY_NAME }}{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
        <p>–°–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –≥–æ—Ç–æ–≤—ã–µ –±–ª—é–¥–∞</p>
    </div>
</section>

<section class="catalog-section">
    <div class="container">
        <div class="catalog-layout">
            <!-- Sidebar Filters -->
            <aside class="catalog-sidebar">
                <div class="filter-section">
                    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <ul class="category-filter">
                        <li>
                            <a href="{% url 'catalog:list' %}" class="{% if not current_category %}active{% endif %}">
                                –í—Å–µ —Ç–æ–≤–∞—Ä—ã
                            </a>
                        </li>
                        {% for category in categories %}
                        <li>
                            <a href="{% url 'catalog:list' %}?category={{ category.slug }}"
                                class="{% if current_category == category.slug %}active{% endif %}">
                                {{ category.icon }} {{ category.name }}
                                <span class="count">{{ category.products_count }}</span>
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="filter-section">
                    <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
                    <ul class="type-filter">
                        <li>
                            <a href="{% url 'catalog:list' %}?filter=featured"
                                class="{% if current_filter == 'featured' %}active{% endif %}">
                                ‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'catalog:list' %}?filter=promo"
                                class="{% if current_filter == 'promo' %}active{% endif %}">
                                üî• –ê–∫—Ü–∏–∏
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'catalog:list' %}?filter=new"
                                class="{% if current_filter == 'new' %}active{% endif %}">
                                üÜï –ù–æ–≤–∏–Ω–∫–∏
                            </a>
                        </li>
                    </ul>
                </div>
            </aside>

            <!-- Products Grid -->
            <div class="catalog-content">
                <!-- Search -->
                <div class="catalog-toolbar">
                    <form class="search-form" action="{% url 'catalog:list' %}" method="get">
                        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." value="{{ search_query }}"
                            class="search-input">
                        <button type="submit" class="search-btn">üîç</button>
                    </form>

                    <div class="results-count">
                        –ù–∞–π–¥–µ–Ω–æ: {{ products|length }} —Ç–æ–≤–∞—Ä–æ–≤
                    </div>
                </div>

                {% if products %}
                <div class="products-grid">
                    {% for product in products %}
                    <article class="product-card" id="product-{{ product.id }}">
                        {% if product.is_promotional %}
                        <span class="product-badge product-badge-promo">-{{ product.discount_percent }}%</span>
                        {% elif product.is_new %}
                        <span class="product-badge product-badge-new">–ù–æ–≤–∏–Ω–∫–∞</span>
                        {% elif product.is_featured %}
                        <span class="product-badge product-badge-featured">–•–∏—Ç</span>
                        {% endif %}

                        <a href="{% url 'catalog:product' product.slug %}" class="product-image-link">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image"
                                loading="lazy">
                            {% else %}
                            <img src="{% static 'images/hero-food.png' %}" alt="{{ product.name }}"
                                class="product-image" loading="lazy">
                            {% endif %}
                        </a>

                        <div class="product-content">
                            <span class="product-category">{{ product.category.name }}</span>
                            <h3 class="product-name">
                                <a href="{% url 'catalog:product' product.slug %}">{{ product.name }}</a>
                            </h3>

                            {% if product.weight %}
                            <span class="product-weight">{{ product.weight }}</span>
                            {% endif %}

                            <div class="product-footer">
                                <div class="product-price">
                                    {% if product.old_price %}
                                    <span class="price-old">{{ product.formatted_old_price }}</span>
                                    {% endif %}
                                    <span class="price-current">{{ product.formatted_price }}</span>
                                </div>

                                <a href="{{ product.get_whatsapp_order_url }}" class="btn btn-cart" target="_blank"
                                    title="–ó–∞–∫–∞–∑–∞—Ç—å –≤ WhatsApp">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347" />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if page_obj.has_other_pages %}
                <nav class="pagination">
                    {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="page-link">‚Üê</a>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <span class="page-link active">{{ num }}</span>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a
                        href="?page={{ num }}" class="page-link">{{ num }}</a>
                        {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="page-link">‚Üí</a>
                        {% endif %}
                </nav>
                {% endif %}

                {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üîç</div>
                    <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                    <a href="{% url 'catalog:list' %}" class="btn btn-primary">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}